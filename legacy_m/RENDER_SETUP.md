# Настройка Render для LEGACY M

## КРИТИЧЕСКИЕ ПЕРЕМЕННЫЕ ОКРУЖЕНИЯ

### 1. RENDER (обязательно!)
```
RENDER=true
```
Эта переменная указывает, что приложение запущено на Render и должна использоваться PostgreSQL.

### 2. DATABASE_URL (обязательно!)
```
DATABASE_URL=postgresql://username:password@hostname:port/database
```
URL для подключения к PostgreSQL базе данных на Render.

### 3. OpenAI API Key
```
OPENAI_API_KEY=sk-proj-...
```

### 4. Anthropic API Key (опционально)
```
ANTHROPIC_API_KEY=sk-ant-...
```

## ИНСТРУКЦИИ ПО НАСТРОЙКЕ

1. **Создайте PostgreSQL базу данных на Render:**
   - Перейдите в Dashboard → New → PostgreSQL
   - Выберите план (Free или Starter)
   - Запомните данные подключения

2. **Добавьте переменные окружения в ваш Web Service:**
   - Перейдите в Settings → Environment
   - Добавьте все переменные выше

3. **Проверьте логи:**
   - После деплоя проверьте логи
   - Должно быть: "✅ Используем PostgreSQL на Render"
   - НЕ должно быть: "⚠️ Используем SQLite"

## ДИАГНОСТИКА ПРОБЛЕМ

### Если база данных все еще SQLite:
- Проверьте, что RENDER=true установлена
- Проверьте, что DATABASE_URL корректный
- Перезапустите сервис

### Если аутентификация не работает:
- Проверьте, что используется PostgreSQL
- Проверьте логи подключения к БД
- Убедитесь, что таблицы созданы

### Если шиитский агент не работает:
- Проверьте логи similarity_score
- Убедитесь, что данные загружены
- Проверьте порог 0.00001
